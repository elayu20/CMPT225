#include "Wordlist.h"
#include <iomanip>
using std::setprecision;
using std::fixed;

// Default constructor
// Creates an empty Wordlist (root is null pointer)
Wordlist::Wordlist() {
	root = nullptr;
	wordCount = 0;
}

// Helper function
void Wordlist::deletePostOrder(AVLTreeNode* node) {
	// left->right->visit
	if (node == nullptr) {
		return;
	}
	deletePostOrder(node->left);
	deletePostOrder(node->right);

	delete node;
}
// Destructor
Wordlist::~Wordlist() {
	deletePostOrder(root);
	root = nullptr;
}

// If word does not exist in list, insert with a count of one
// If word exists in list, increment word's count
void Wordlist::insert(string word) {
	// Empty tree
	if (root == nullptr) {
		root = new AVLTreeNode(word);
		wordCount++;
		return;
	}

	AVLTreeNode* current = root;
	AVLTreeNode* parent;
	int newNodeHeight = 0;
	// Keeps track of which child search ended at on NULL
	// 1 if left, 2 if right
	int whichChild;

	// Traversing through tree, just checking if word exists
	while (current != nullptr) {
		// Word already exists, increment and stop
		if (word == current->word) {
			current->count++;
			return;
		}
		else if (word < current->word) {
			parent = current;
			current = current->left;
			whichChild = 1;
		}
		else {
			parent = current;
			current = current->right;
			whichChild = 2;
		}
		newNodeHeight++;
		wordCount++;
	}

	// Word doesn't exist, create new node
	AVLTreeNode *newNode = new AVLTreeNode(word);
	newNode->height = newNodeHeight;
	newNode->parent = parent;

	if (whichChild == 1) {
		parent->left = newNode;
	}
	else if (whichChild == 2) {
		parent->right = newNode;
	}
}

// Returns count of string word parameter
int Wordlist::getCount(string word) {
	AVLTreeNode* current = root;

	while (current != nullptr) {
		if (word == current->word) {
			return current->count;
		}
		// In left subtree if current word is larger
		else if (word < current->word) {
			current = current->left;
		}
		// In right subtree if current word is smaller
		else {
			current = current->right;
		}
	}

	return 0;
}

// Returns true if string parameter is in word list, otherwise false
bool Wordlist::contains(string word) {
	AVLTreeNode* current = root;

	while (current != nullptr) {
		if (word == current->word) {
			return true;
		}
		// In left subtree if current word is larger
		else if (word < current->word) {
			current = current->left;
		}
		// In right subtree if current word is smaller
		else {
			current = current->right;
		}
	}

	return false;
}

int Wordlist::differentWords() const {
	return wordCount;
}

int Wordlist::totalWords() const {
	return 0;
}

string Wordlist::mostFrequent() const {
	return "it";
}

int Wordlist::singletons() const {
	return 0;
}

// Prints useful statistics about the word list
void Wordlist::printStatistics() const
{
	cout << "Number of different words: " << differentWords() << endl;
	cout << "    Total number of words: " << totalWords() << endl;
	cout << "       Most frequent word: " << mostFrequent() << endl;
	cout << "     Number of singletons: " << singletons()
		<< setprecision(0) << fixed
		<< " (" << 100.0 * singletons() / differentWords() << "%)"
		<< endl;
}
